
title: Kotletochka smart home
views:

  - title: Главная
    path: main-page
    icon: mdi:home-assistant
    cards:

      - type: vertical-stack
        cards:

        - type: markdown
          content: >
             **Текущее состояние**

        - type: entities
          show_header_toggle: false
          entities:
            - entity: sensor.date
              name: Дата
              icon: mdi:calendar-check-outline
            - entity: sensor.time
              name: Время
              icon: mdi:clock-outline
            - entity: sensor.last_boot_custom
            - entity: sensor.online_custom
            - entity: sensor.cert_expiry_keenetic_domain

        - type: markdown
          content: >
             **Резервное копирование**

        - type: entities
          show_header_toggle: false
          entities:
            - entity: sensor.snapshots_in_hassio_train
            - entity: sensor.snapshots_in_google_drive_train
            - entity: sensor.last_google_backup_train

        - type: markdown
          content: >
             **Использование э/э**

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: energy-date-selection
            - type: energy-usage-graph

      - type: vertical-stack
        cards:
        - type: markdown
          content: >
             **Графики** 

        - type: horizontal-stack
          cards:

            - type: gauge
              name: Загрузка CPU
              unit: '%'
              entity: sensor.processor_use
              needle: true
              severity:
                green: 0
                yellow: 60
                red: 85

            - type: gauge
              name: Использование ОЗУ
              unit: '%'
              entity: sensor.memory_use_percent
              needle: true
              severity:
                green: 0
                yellow: 60
                red: 85
                
        - type: horizontal-stack
          cards:

            - type: gauge
              name: Диск заполнен
              unit: '%'
              entity: sensor.disk_use_percent
              severity:
                green: 0
                yellow: 60
                red: 85
                
            - type: gauge
              name: Свободное место
              unit: 'Гб'
              min: 0
              max: 233
              entity: sensor.disk_free
              severity:
                red: 0
                yellow: 3
                green: 8

        - type: custom:mini-graph-card
          entities:
            - entity: sensor.processor_temperature
          show:
            extrema: true
            labels: true
          hour24: true
          font_size: 70
          points_per_hour: 6
          hours_to_show: 12

        - type: 'custom:mini-graph-card'
          entities:
            - entity: sensor.speedtest_download
              name: Download
              show_state: true
            - entity: sensor.speedtest_upload
              name: Upload
              show_state: true
            - entity: sensor.speedtest_ping
              name: Ping
          show:
            extrema: true
            labels: true
          align_state: center
          font_size: 70
          hour24: true
          hours_to_show: 24
          name: Speedtest.net
          points_per_hour: 1
        #   tap_action:
        #     action: call-service
        #     service: speedtestdotnet.speedtest

      - type: vertical-stack
        cards:

        - type: markdown
          content: >
             **Состояние баз** 

        - type: entities
          show_header_toggle: false
          entities:
            - entity: sensor.maria_db_size
              secondary_info: entity-id
            - entity: sensor.maria_db_folder_size
              secondary_info: entity-id
            - type: call-service
              icon: mdi:database-minus
              name: База данных
              action_name: Сжать
              service: automation.trigger
              service_data:
                entity_id: automation.db_purge_everyday
            - type: divider
            - entity: sensor.influxdb_db_folder_size
              secondary_info: entity-id

        - type: markdown
          content: >
             **Розетка сервера** 

        - type: horizontal-stack
          cards:
            - entity: switch.shelly_plug_s_1
              state_color: true
              icon_height: 50px
              type: button
              tap_action:
                action: call-service
                service: switch.toggle
                service_data:
                  entity_id: switch.shelly_plug_s_1
                confirmation:
                  text: Вкл/выкл розетку?

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: sensor.shelly_plug_s_1_power
                  - entity: sensor.total_server_socket_cable_daily_electicity
                  - entity: sensor.total_server_socket_cable_monthly_electicity

  - title: Освещение
    path: lights
    icon: mdi:lightbulb-group
    cards:
      - type: vertical-stack
        cards:
        - type: markdown
          content: >
             **Освещение детская** 
        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          title: 'Потолочный светильник'
          cards:
            - type: entities
              show_header_toggle: false
              entities:          
                - entity: binary_sensor.0x158d0003f37a0f_contact
                  secondary_info: last-changed
                  state_color: true
                - entity: switch.0x54ef441000096cbc
                  secondary_info: last-changed
                  state_color: true
            - type: horizontal-stack
              cards:
                - type: light
                  entity: light.yeelight_ceiling_cr
                  name: Люстра
                - type: light
                  entity: light.yeelight_ceiling_cr_nightlight
                  name: Ночник
                - type: light
                  entity: light.yeelight_ceiling_cr_ambilight
                  name: Ambilight

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: sensor.0x54ef441000096cbc_power
                  - entity: sensor.total_yeelight_ceiling_relay_cable_daily_electicity
                  - entity: sensor.total_yeelight_ceiling_relay_cable_monthly_electicity

      - type: vertical-stack
        cards:
        - type: markdown
          content: >
             **Освещение кухня**    

        - type: entities
          show_header_toggle: false
          state_color: true
          entities:
            - entity: switch.0x086bd7fffe5d13c9
              secondary_info: last-changed

        - type: markdown
          content: >
             **Освещение/вытяжка туалет**    

        - type: entities
          show_header_toggle: false
          state_color: true
          entities:
            - entity: switch.0x086bd7fffe5b7c7f_right
              secondary_info: last-changed
            - entity: switch.0x086bd7fffe5b7c7f_left
              secondary_info: last-changed

        - type: markdown
          content: >
             **Освещение/вытяжка ванная**    

        - type: entities
          show_header_toggle: false
          state_color: true
          entities:
            - entity: switch.0x086bd7fffe5aecf8_left
              secondary_info: last-changed
            - entity: switch.0x086bd7fffe5aecf8_right
              secondary_info: last-changed

  - title: Zigbee
    path: zigbee-devices
    icon: mdi:zigbee
    cards:
      - type: vertical-stack
        cards:
        - type: markdown
          content: >
             **Шлюз** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:

            - type: custom:vertical-stack-in-card
              card_mod:
                style: |
                  ha-card {
                    border: none;
                  }
              horizontal: true
              cards:

                - type: alarm-panel
                  entity: alarm_control_panel.signalka_shliuza_alarm
                  name: 'GW: '
                  states:
                    - arm_away

                - type: button
                  show_name: false
                  entity: input_boolean.alarm_gateway_button

            - type: entities
              show_header_toggle: false
              entities:
                - entity: light.gateway_light_04cf8cabd77b
                - entity: sensor.signalka_shliuza_illuminance
                - entity: sensor.0x54ef4410000ebba0_illuminance
                

        - type: markdown
          content: >
             **Двери, окна, движение, выключатели детская** 
        
        - type: glance
          columns: 5
          entities:
            - entity: binary_sensor.0x158d00045ca483_smoke
              show_last_changed: true
              name: Детская
            - entity: binary_sensor.0x158d00054b8d72_motion
              show_last_changed: true
              name: Детская
            - entity: binary_sensor.0x158d0003f37a0f_contact
              show_last_changed: true
              icon: mdi:ceiling-light
              name: Свет
            - entity: binary_sensor.0x158d000396f1f9_contact
              show_last_changed: true
              name: Окно
            - entity: binary_sensor.0x158d00039677d9_contact
              show_last_changed: true
              name: Балкон

        - type: markdown
          content: >
             **Двери, окна, движение, выключатели спальня** 
        
        - type: glance
          columns: 5
          entities:
            - entity: binary_sensor.0x158d00045cd551_smoke
              show_last_changed: true
              name: Спальня
            - entity: binary_sensor.0x158d0003fa6b60_contact
              show_last_changed: true
              name: Окно
            - entity: binary_sensor.0x158d0003981f6d_contact
              show_last_changed: true
              name: Балкон

        - type: markdown
          content: >
             **Двери, окна, движение, выключатели гостиная** 
        
        - type: glance
          columns: 5
          entities:
            - entity: binary_sensor.0x158d00039a8358_smoke
              show_last_changed: true
              name: Гостиная
            - entity: binary_sensor.0x158d000396f197_contact
              show_last_changed: true
              name: Лев.
            - entity: binary_sensor.0x158d0003d05782_contact
              show_last_changed: true
              name: Центр.
            - entity: binary_sensor.0x158d0003975d8b_contact
              show_last_changed: true
              name: Прав.

        - type: markdown
          content: >
             **Двери, окна, движение, выключатели кухня** 
        
        - type: glance
          columns: 5
          entities:
            - entity: binary_sensor.0x158d0003943639_smoke
              show_last_changed: true
              name: Кухня
            - entity: binary_sensor.0x158d0003975b4c_contact
              show_last_changed: true
              name: Лев.
            - entity: binary_sensor.0x158d00039a2f33_contact
              show_last_changed: true
              name: Прав.

        - type: markdown
          content: >
             **Двери, движение, выключатели коридор** 
        
        - type: glance
          columns: 5
          entities:
            - entity: binary_sensor.0x158d00039d9398_smoke
              show_last_changed: true
              name: 'Коридор'
            - entity: binary_sensor.0x158d0003cfa725_contact
              show_last_changed: true
              name: 'Тамбурная'
            - entity: binary_sensor.0x158d000359304c_contact
              show_last_changed: true
              name: 'Входная'
            - entity: binary_sensor.0x158d000566bde7_motion
              show_last_changed: true
              name: 'Коридор 1'
            - entity: binary_sensor.0x158d0003953ee9_motion
              show_last_changed: true
              name: 'Коридор 2'

        - type: markdown
          content: >
             **Горячее водоснабжение** 
        
        - type: glance
          columns: 5
          entities:
            - entity: sensor.0x158d0006c5f21e_temperature
              name: 'Ванная'
            - entity: sensor.0x158d0006b860cf_temperature
              name: 'Санузел'
            - entity: sensor.0x00158d0008386b56_temperature
              name: 'Отопление'

      - type: vertical-stack
        cards:

        - type: markdown
          content: >
             **Уровень заряда** 

        - type: custom:battery-state-card
          color_gradient:
              - "#ff0000" # red
              - "#ffff00" # yellow
              - "#008000" # green
          sort_by_level: "asc"
          collapse: 
              - name: 'Герконы (min: {min}%, кол-во: {count})'
                secondary_info: 'Диапазон заряда {range}%'
                icon: 'mdi:door'
                min: 30
                entities:
                  - sensor.0x158d000359304c_battery
                  - sensor.0x158d0003cfa725_battery
                  - sensor.0x158d000490fe9d_battery
                  - sensor.0x158d0003f37a0f_battery
                  - sensor.0x158d00039677d9_battery
                  - sensor.0x158d0003981f6d_battery
                  - sensor.0x158d0003fa6b60_battery
                  - sensor.0x158d000396f1f9_battery
                  - sensor.0x158d0003975b4c_battery
                  - sensor.0x158d000396f197_battery
                  - sensor.0x158d0003d05782_battery
                  - sensor.0x158d0003975d8b_battery
                  - sensor.0x158d00039a2f33_battery
              - name: 'Дыма (min: {min}%, кол-во: {count})'
                secondary_info: 'Диапазон заряда {range}%'
                icon: 'mdi:smoke-detector'
                min: 30
                entities:
                  - sensor.0x158d00039a8358_battery
                  - sensor.0x158d00039d9398_battery
                  - sensor.0x158d00045ca483_battery
                  - sensor.0x158d00045cd551_battery
                  - sensor.0x158d0003943639_battery
              - name: 'Т&Rh (min: {min}%, кол-во: {count})'
                secondary_info: 'Диапазон заряда {range}%'
                icon: 'mdi:thermometer'
                min: 30
                entities:
                  - sensor.0x158d0004561de9_battery
                  - sensor.0x158d000542ceaf_battery
                  - sensor.0x158d0006c5f21e_battery
                  - sensor.0x158d0006b860cf_battery
                  - sensor.0x00158d0008386b56_battery
              - name: 'Движения (min: {min}%, кол-во: {count})'
                secondary_info: 'Диапазон заряда {range}%'
                icon: 'mdi:motion-sensor'
                min: 30
                entities:
                  - sensor.0x158d000566bde7_battery
                  - sensor.0x158d0003953ee9_battery
                  - sensor.0x158d00054b8d72_battery
              - name: 'Кнопки (min: {min}%, кол-во: {count})'
                secondary_info: 'Диапазон заряда {range}%'
                icon: 'mdi:radiobox-marked'
                min: 30
                entities:
                  - sensor.0x158d0003a360b6_battery
                  - sensor.0x158d00045a78af_battery
                  - sensor.0x54ef4410000ebba0_battery
              - name: 'Часы (min: {min}%, кол-во: {count})'
                secondary_info: 'Диапазон заряда {range}%'
                icon: 'mdi:alarm-check'
                min: 30
                entities:
                  - sensor.esp_xiaomi_bed_room_battery_level
                  - sensor.esp_xiaomi_kitchen_battery_level
                  - sensor.esp_xiaomi_living_room_battery_level
                  - sensor.esp_xiaomi_childrens_room_battery_level
              - name: 'Моторы штор (min: {min}%, кол-во: {count})'
                secondary_info: 'Диапазон заряда {range}%'
                icon: 'mdi:blinds-vertical'
                min: 30
                entities:
                  - sensor.0x54ef4410005602ed_battery
                  - sensor.0x54ef44100055ff04_battery
          entities:
            - entity: sensor.0x158d000359304c_battery
              tap_action: more-info
            - entity: sensor.0x158d0003cfa725_battery
              tap_action: more-info
            - entity: sensor.0x158d0003f37a0f_battery
              tap_action: more-info
            - entity: sensor.0x158d000542ceaf_battery
              tap_action: more-info
            - entity: sensor.0x158d0006c5f21e_battery
              tap_action: more-info
            - entity: sensor.0x158d0006b860cf_battery
              tap_action: more-info
            - entity: sensor.0x00158d0008386b56_battery
              tap_action: more-info
            - entity: sensor.0x158d0004561de9_battery
              tap_action: more-info
            - entity: sensor.0x54ef4410000ebba0_battery
              tap_action: more-info
            - entity: sensor.0x158d00045cd551_battery
              tap_action: more-info
            - entity: sensor.0x158d00045ca483_battery
              tap_action: more-info
            - entity: sensor.0x158d0003943639_battery
              tap_action: more-info
            - entity: sensor.0x158d00039a8358_battery
              tap_action: more-info
            - entity: sensor.0x158d00039d9398_battery
              tap_action: more-info
            - entity: sensor.0x158d000490fe9d_battery
              tap_action: more-info
            - entity: sensor.0x158d000566bde7_battery
              tap_action: more-info
            - entity: sensor.0x158d0003953ee9_battery
              tap_action: more-info
            - entity: sensor.0x158d00054b8d72_battery
              tap_action: more-info
            - entity: sensor.0x158d0003a360b6_battery
              tap_action: more-info
            - entity: sensor.0x158d00045a78af_battery
              tap_action: more-info
            - entity: sensor.esp_xiaomi_bed_room_battery_level
              tap_action: more-info
              name: 'Часы спальня'
            - entity: sensor.esp_xiaomi_kitchen_battery_level
              tap_action: more-info
              name: 'Часы кухня'
            - entity: sensor.esp_xiaomi_living_room_battery_level
              tap_action: more-info
              name: 'Часы гостиная'
            - entity: sensor.esp_xiaomi_childrens_room_battery_level
              tap_action: more-info
              name: 'Часы детская'
            - entity: sensor.0x158d000396f1f9_battery
              tap_action: more-info
            - entity: sensor.0x158d0003fa6b60_battery
              tap_action: more-info
            - entity: sensor.0x158d0003981f6d_battery
              tap_action: more-info
            - entity: sensor.0x158d00039677d9_battery
              tap_action: more-info
            - entity: sensor.0x158d0003d05782_battery
              tap_action: more-info
            - entity: sensor.0x158d0003975b4c_battery
              tap_action: more-info
            - entity: sensor.0x158d000396f197_battery
              tap_action: more-info
            - entity: sensor.0x158d0003975d8b_battery
              tap_action: more-info
            - entity: sensor.0x158d00039a2f33_battery
              tap_action: more-info
            - entity: sensor.0x54ef4410005602ed_battery
              tap_action: more-info
            - entity: sensor.0x54ef44100055ff04_battery
              tap_action: more-info

        - type: markdown
          content: >
             **Стик zigbee** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: custom:vertical-stack-in-card
              horizontal: true
              card_mod:
                style: |
                  ha-card {
                    border: none;
                  }
              cards:

                - type: button
                  name: Поиск zigbee
                  show_state: false
                  show_name: false
                  entity: switch.permit_join_switch_z2m
                  icon: mdi:cellphone-wireless

                - type: entities
                  show_header_toggle: false
                  entities:          
                    - entity: timer.zigbee_permit_join

            - type: entities
              show_header_toggle: false
              entities:
                - entity: sensor.zigbee2mqtt_coordinator_ver
                - entity: sensor.sostoianie_mosta
                - entity: script.zigbee2mqtt_linkuality_check

      - type: vertical-stack
        cards:

        - type: markdown
          content: >
             **Входная э/э** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: sensor.shelly_em_voltage
                  - entity: sensor.shelly_em_power
                  - entity: sensor.total_shelly_em_cable_daily_electicity
                  - entity: sensor.total_shelly_em_cable_monthly_electicity

        - type: markdown
          content: >
             **Розетка водонагревателя** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: switch.0x842e14fffe13a854
                    state_color: true
                    secondary_info: last-changed
                  - entity: input_boolean.water_heater_season
                    state_color: true
                  - entity: sensor.0x842e14fffe13a854_power
                  - entity: sensor.total_water_heater_socket_cable_daily_electicity
                  - entity: sensor.total_water_heater_socket_cable_monthly_electicity
                  
        - type: markdown
          content: >
             **Розетка обогревателя Electrolux** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: switch.0x842e14fffe5047f5
                    state_color: true
                    secondary_info: last-changed
                  - entity: input_boolean.heater_night_mode
                    state_color: true
                  - entity: sensor.0x842e14fffe5047f5_power
                  - entity: sensor.total_heater_socket_cable_daily_electicity
                  - entity: sensor.total_heater_socket_cable_monthly_electicity

        - type: markdown
          content: >
             **Розетка Data Storage** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: switch.shelly_plug_s_2
                    state_color: true
                    secondary_info: last-changed
                  - entity: sensor.shelly_plug_s_2_power
                  - entity: sensor.total_shelly_plug_s_2_cable_daily_electicity
                  - entity: sensor.total_shelly_plug_s_2_cable_monthly_electicity

        - type: markdown
          content: >
             **Розетка в кухне 1** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: switch.0x842e14fffe36661f
                    state_color: true
                    secondary_info: last-changed
                  - entity: sensor.0x842e14fffe36661f_power
                  - entity: sensor.total_kithen_socket_1_cable_daily_electicity
                  - entity: sensor.total_kitchen_socket_1_cable_monthly_electicity

        - type: markdown
          content: >
             **Розетка в спальне 1** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: switch.0x588e81fffeff5c4f
                    state_color: true
                    secondary_info: last-changed
                  - entity: sensor.0x588e81fffeff5c4f_power
                  - entity: sensor.total_bedroom_socket_1_cable_daily_electicity
                  - entity: sensor.total_bedroom_socket_1_cable_monthly_electicity

        - type: markdown
          content: >
             **Розетка в спальне 2** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: switch.0x60a423fffef8d41a
                    state_color: true
                    secondary_info: last-changed
                  - entity: sensor.0x60a423fffef8d41a_power
                  - entity: sensor.total_bedroom_socket_2_cable_daily_electicity
                  - entity: sensor.total_bedroom_socket_2_cable_monthly_electicity

  - title: Климат
    path: climate-device
    icon: mdi:home-thermometer
    cards:
      - type: vertical-stack
        cards:

        - type: markdown
          content: >
             **Погода**

        - type: custom:weather-card
          name: " "
          entity: weather.kotletochka_home

        - type: markdown
          content: >
             **Увлажнитель детская** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: humidifier.zhimi_humidifier_ca4
                    type: custom:custom-fan-card
                    name: 'Вкл/Выкл'
                    state_color: true
                    model: 'zhimi.humidifier.ca4'
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_ca4_water_level
                          name: 'Вода'
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_ca4_actual_speed
                          name: 'Об/м'
            - type: entities
              show_header_toggle: false
              entities:
                  - type: conditional
                    conditions:
                      - entity: binary_sensor.zhimi_humidifier_ca4_current_mode
                        state: 'on'
                    row:
                        entity: input_number.zhimi_humidifier_ca4_target_humidity
                  - entity: switch.zhimi_humidifier_ca4_buzzer
                    state_color: true
                    name: Звуки
                  - entity: select.zhimi_humidifier_ca4_led_brightness
                    name: Яркость LED
                  - entity: switch.zhimi_humidifier_ca4_dry_mode
                    state_color: true
                    name: Осущение
                  - entity: switch.zhimi_humidifier_ca4_child_lock
                    state_color: true
                    name: Защита от детей

        - type: markdown
          content: >
             **Увлажнитель спальня** 

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: humidifier.zhimi_humidifier_cb1
                    type: custom:custom-fan-card
                    name: 'Вкл/Выкл'
                    state_color: true
                    model: 'zhimi.humidifier.cb1'
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_cb1_water_level
                          name: 'Вода'
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_cb1_motor_speed
                          name: 'Об/м'
            - type: entities
              show_header_toggle: false
              entities:
                  - type: conditional
                    conditions:
                      - entity: binary_sensor.zhimi_humidifier_cb1_current_mode
                        state: 'on'
                    row:
                        entity: input_number.zhimi_humidifier_cb1_target_humidity
                  - entity: switch.zhimi_humidifier_cb1_buzzer
                    state_color: true
                    name: Звуки
                  - entity: select.zhimi_humidifier_cb1_led_brightness
                    name: Яркость LED
                  - entity: switch.zhimi_humidifier_cb1_dry_mode
                    state_color: true
                    name: Осущение
                  - entity: switch.zhimi_humidifier_cb1_child_lock
                    state_color: true
                    name: Защита от детей

      - type: vertical-stack
        cards:

        - type: markdown
          content: >
             **Температура, влажность, давление** 
        
        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.0x158d000542ceaf_temperature
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.0x158d000542ceaf_humidity
            - type: entities
              show_header_toggle: false
              entities:
                  - entity: sensor.158d000542ceaf_pressure
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_childrens_room_temperature
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_childrens_room_humidity
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_ca4_temperature
                          name: Т увлаж.
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_ca4_humidity
                          name: RH увлаж.
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_bed_room_temperature
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_bed_room_humidity
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_cb1_temperature
                          name: Т увлаж.
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.zhimi_humidifier_cb1_humidity
                          name: RH увлаж.
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.0x158d0004561de9_temperature
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.0x158d0004561de9_humidity
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_kitchen_temperature
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_kitchen_humidity
            - type: horizontal-stack
              cards:
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_living_room_temperature
                  - type: entities
                    show_header_toggle: false
                    entities:
                        - entity: sensor.esp_xiaomi_living_room_humidity

        - type: markdown
          content: >
             **Кондиционер гостиная** 
        - type: thermostat
          entity: climate.avatto_living_room_ac
          name: " "

      - type: vertical-stack
        cards:

        - type: markdown
          content: >
             **Термоголовка детская** 
        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: custom:vertical-stack-in-card
              card_mod:
                style: |
                  ha-card {
                    border: none;
                  }
              horizontal: true
              cards:
                - type: gauge
                  entity: sensor.thermostat_childrens_room_valve_position
                - type: thermostat
                  entity: climate.0x5c0272fffec89454
                  name: " "
    
            - type: glance
              show_state: false
              state_color: true
              columns: 3
              entities:
                    - type: entity
                      name: Блок. кнопок
                      entity: switch.0x5c0272fffec89454_child_lock_switch
                      tap_action:
                        action: toggle
    
                    - type: button
                      show_name: false
                      entity: input_boolean.thermostat_childrensroom_night_mode
                      tap_action:
                        action: toggle
    
                    - type: entity
                      name: Низкий заряд
                      entity: binary_sensor.debounce_trv_childrens_room_low_battery

        - type: markdown
          content: >
             **Термоголовка спальня** 
        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: custom:vertical-stack-in-card
              card_mod:
                style: |
                  ha-card {
                    border: none;
                  }
              horizontal: true
              cards:

                - type: gauge
                  entity: sensor.thermostat_bedroom_valve_position
    
                - type: thermostat
                  entity: climate.0x60a423fffe968719
                  name: " "
    
            - type: glance
              #show_name: false
              show_state: false
              state_color: true
              columns: 3
              entities:

                    - type: entity
                      name: Блок. кнопок
                      entity: switch.0x60a423fffe968719_child_lock_switch
                      tap_action:
                        action: toggle

                    - type: button
                      show_name: false
                      entity: input_boolean.thermostat_bedroom_night_mode
                      tap_action:
                        action: toggle
                      
                    - type: entity
                      name: Низкий заряд
                      entity: binary_sensor.debounce_trv_bedroom_low_battery

        - type: markdown
          content: >
             **Термоголовка гостиная** 
        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: custom:vertical-stack-in-card
              card_mod:
                style: |
                  ha-card {
                    border: none;
                  }
              horizontal: true
              cards:
                - type: gauge
                  entity: sensor.thermostat_living_room_valve_position
                - type: thermostat
                  entity: climate.0x5c0272fffec9db22
                  name: " "
    
            - type: glance
              show_state: false
              state_color: true
              columns: 2
              entities:
                    - type: entity
                      name: Блок. кнопок
                      entity: switch.0x5c0272fffec9db22_child_lock_switch
                      tap_action:
                        action: toggle
                    
                    - type: entity
                      name: Низкий заряд
                      entity: binary_sensor.debounce_trv_living_room_low_battery

        - type: markdown
          content: >
             **Термоголовка кухня** 
        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: custom:vertical-stack-in-card
              card_mod:
                style: |
                  ha-card {
                    border: none;
                  }
              horizontal: true
              cards:
                - type: gauge
                  entity: sensor.thermostat_kitchen_valve_position
                - type: thermostat
                  entity: climate.0x5c0272fffe8de819
                  name: " "
    
            - type: glance
              show_state: false
              state_color: true
              columns: 2
              entities:
                    - type: entity
                      name: Блок. кнопок
                      entity: switch.0x5c0272fffe8de819_child_lock_switch
                      tap_action:
                        action: toggle
                      
                    - type: entity
                      name: Низкий заряд
                      entity: binary_sensor.debounce_trv_kitchen_low_battery

  - title: Шторы
    icon: mdi:roller-shade
    path: shades
    cards:

      - type: vertical-stack
        cards:
        - type: markdown
          content: >
             **Шторы кухня**

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: 'custom:mushroom-cover-card'
              entity: cover.cover_group_kitchen
              name: Группа
              show_position_control: true
              show_buttons_control: true
    
            - type: 'custom:mushroom-cover-card'
              entity: cover.0x847127fffed62861
              name: Левая
              show_position_control: true
    
            - type: 'custom:mushroom-cover-card'
              entity: cover.0x847127fffed4907d
              name: Правая
              show_position_control: true

      - type: vertical-stack
        cards:
        - type: markdown
          content: >
             **Шторы гостиная**

        - type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border: none;
              }
          cards:
            - type: 'custom:mushroom-cover-card'
              entity: cover.cover_group_living_room
              name: Группа
              show_position_control: true
              show_buttons_control: true
    
            - type: 'custom:mushroom-cover-card'
              entity: cover.0x54ef4410005602ed
              name: Левая
              show_position_control: true
    
            - type: 'custom:mushroom-cover-card'
              entity: cover.0x54ef44100055ff04
              name: Правая
              show_position_control: true

  - title: Пылесос
    path: vacuum
    #panel: true
    icon: mdi:robot-vacuum
    cards:
      - type: custom:xiaomi-vacuum-map-card
        entity: vacuum.xiaomi_vacuum_cleaner
        map_locked: true
        map_source:
          camera: camera.roborock_vacuum_map
        calibration_source:
          camera: true
        map_modes:
          - template: vacuum_clean_zone
          - name: Комнаты
            icon: mdi:floor-plan
            selection_type: ROOM
            max_selections: 8
            repeats_type: REPEAT
            max_repeats: 3
            service_call_schema:
              service: vacuum.send_command
              service_data:
                params: "[[selection]]"
                entity_id: "[[entity_id]]"
                command: app_segment_clean
            predefined_selections:
              - id: 1
                outline: [[19697, 23978], [22693, 23978], [22682, 23147], [22441, 23147], [22462, 19658], [19645, 19668]]
                label:
                  text: "Спальня"
                  x: 20953
                  y: 21654
                  offset_y: 35
                icon:
                  name: "mdi:bed-king"
                  x: 20953
                  y: 21654
              - id: 16
                outline: [[19727, 24250], [22427, 24266], [22427, 28415], [19661, 28415]]
                label:
                  text: "Детская"
                  x: 20953
                  y: 26835
                  offset_y: 35
                icon:
                  name: "mdi:bed-queen"
                  x: 20953
                  y: 26835
              - id: 18
                outline: [[23818, 23150], [25596, 23150], [25596, 24276], [23818, 24285]]
                icon:
                  name: "mdi:bathtub"
                  x: 24682
                  y: 23695
              - id: 17
                outline: [[22657, 26657], [26115, 26657], [26115, 31398], [22657, 31398]]
                label:
                  text: "Гостиная"
                  x: 24510
                  y: 29349
                  offset_y: 35
                icon:
                  name: "mdi:sofa"
                  x: 24510
                  y: 29349
              - id: 20
                outline: [[27721, 27885], [28849, 27885], [28849, 26383], [27721, 26383]]
                icon:
                  name: "mdi:paper-roll"
                  x: 28285
                  y: 27174
              - id: 19
                outline: [[27721, 26383], [28849, 26383], [28849, 25562], [27721, 25562]]
                icon:
                  name: "mdi:hanger"
                  x: 28285
                  y: 25967
              - id: 2
                outline: [[27451, 27972], [26250, 27972], [26250, 31427], [27310, 32477], [28695, 32477], [28711, 28933], [28122, 28933], [28122, 28584], [27451, 28584]]
                label:
                  text: "Кухня"
                  x: 27486
                  y: 30348
                  offset_y: 35
                icon:
                  name: "mdi:silverware-fork-knife"
                  x: 27486
                  y: 30348
              - id: 21
                outline: [[23638, 23142], [22703, 23142], [22703, 26588], [26247, 26588], [26247, 27932], [27600, 27932], [27600, 25151], [23638, 25151]]
                label:
                  text: "Коридор"
                  x: 24913
                  y: 25830
                icon:
                  name: "mdi:shoe-print"
                  x: 23626
                  y: 25830
          - template: vacuum_goto
          - template: vacuum_follow_path
        tiles:
          - label: 'Статус'
            entity: vacuum.xiaomi_vacuum_cleaner
            attribute: status
            icon: mdi:robot-vacuum
          - label: 'Заряд'
            entity: vacuum.xiaomi_vacuum_cleaner
            attribute: battery_level
            icon: mdi:battery-charging-100
            unit: '%'
          - label: 'Режим'
            entity: vacuum.xiaomi_vacuum_cleaner
            attribute: fan_speed
            icon: mdi:fan
            conditions:
              - entity: vacuum.xiaomi_vacuum_cleaner
                value: docked
          - label: 'Площадь'
            entity: sensor.xiaomi_vacuum_cleaner_total_clean_area
            icon: mdi:texture-box
            unit: 'м²'
            precision: 0
            conditions:
              - entity: vacuum.xiaomi_vacuum_cleaner
                value: docked
          - label: 'Длительность'
            entity: sensor.xiaomi_vacuum_cleaner_current_clean_duration
            icon: mdi:timer-sand
            multiplier: 0.01666666666
            precision: 0
            unit: 'м'
            conditions:
              - entity: vacuum.xiaomi_vacuum_cleaner
                value_not: docked
          - label: 'Площадь'
            entity: sensor.xiaomi_vacuum_cleaner_current_clean_area
            icon: mdi:texture-box
            unit: 'м²'
            precision: 0
            conditions:
              - entity: vacuum.xiaomi_vacuum_cleaner
                value_not: docked
          - label: 'Датчики'
            entity: sensor.xiaomi_vacuum_cleaner_sensor_dirty_left
            icon: mdi:eye-settings-outline
            multiplier: 0.00027777777
            precision: 0
            unit: 'ч'
            double_tap_action:
              action: call-service
              service: vacuum.send_command
              service_data:
                entity_id: vacuum.xiaomi_vacuum_cleaner
                command: reset_consumable
                params: ['sensor_dirty_time']
          - label: 'Фильтр'
            entity: sensor.xiaomi_vacuum_cleaner_filter_left
            multiplier: 0.00027777777
            precision: 0
            icon: mdi:air-filter
            unit: 'ч'
            double_tap_action:
              action: call-service
              service: vacuum.send_command
              service_data:
                entity_id: vacuum.xiaomi_vacuum_cleaner
                command: reset_consumable
                params: ['filter_work_time']
          - label: 'Боковая'
            entity: sensor.xiaomi_vacuum_cleaner_side_brush_left
            multiplier: 0.00027777777
            precision: 0
            icon: mdi:cross-bolnisi
            unit: 'ч'
            double_tap_action:
              action: call-service
              service: vacuum.send_command
              service_data:
                entity_id: vacuum.xiaomi_vacuum_cleaner
                command: reset_consumable
                params: ['side_brush_work_time']
          - label: 'Основная'
            entity: sensor.xiaomi_vacuum_cleaner_main_brush_left
            multiplier: 0.00027777777
            precision: 0
            icon: mdi:robot-vacuum-variant
            unit: 'ч'
            double_tap_action:
              action: call-service
              service: vacuum.send_command
              service_data:
                entity_id: vacuum.xiaomi_vacuum_cleaner
                command: reset_consumable
                params: ['main_brush_work_time']

  - title: Сводная таблица GW3
    path: gw3
    icon: mdi:radio-tower
    panel: true
    cards:
      - type: vertical-stack
        cards:
          # Gateways
          - type: markdown
            content: '<center> <ha-icon icon="mdi:router-wireless"></ha-icon> Gateways </center>'
          - type: "custom:flex-table-card"
            clickable: false
            entities:
              include:
                - binary_sensor.*_gateway
            sort_by: friendly_name
            columns:
              - data: friendly_name
                name: Friendly Name
                modify: '(x+"").replace(/ Gateway$/,"")'
              - data: network_pan_id
                name: PAN ID
                modify: 'x == "" ? "-" : x+""'
              - data: fw_version
                name: FW ver
              - data: radio_tx_power
                name: TX Power
                modify: 'isNaN(parseInt(x, 10)) ? "-" : parseInt(x, 10)'
              - data: radio_channel
                name: Channel
                modify: 'isNaN(parseInt(x, 10)) ? "-" : parseInt(x, 10)'
              - data: free_mem
                name: Mem Free (KB)
                modify: 'isNaN(parseInt(x, 10)) ? "" : parseInt(x, 10)'
              - data: load_avg
                name: Load Avg (1m, 5m, 15m)
                modify: '(x+"").split("|").slice(0, 3).join(", ")'
              - data: zigbee_tx
                name: ZB Tx
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: zigbee_rx
                name: ZB Rx
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: zigbee_oe
                name: ZB Err
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
            #   - data: bluetooth_tx
            #     name: BT Tx
            #     modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
            #   - data: bluetooth_rx
            #     name: BT Rx
            #     modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
            #   - data: bluetooth_oe
            #     name: BT Err
            #     modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: rssi
                name: RSSI
                modify: 'isNaN(parseInt(x, 10)) ? "" : (100 + parseInt(x, 10)) * -1'
              - data: uptime
                name: Gateway Uptime
                modify: x+''
              - name: Connected Since
                data: last_changed, state
                multi_delimiter: ","
                modify: >
                  if (x.split(",")[1] == 'on') {
                  var dr = x.split(",")[0];
                  var dt = new Date(dr);
                  var hrs = parseInt((Date.now()-Date.parse(dr)) / 3600000);
                  var min = parseInt(((Date.now()-Date.parse(dr)) / 60000) % 60);
                  var sec = parseInt(((Date.now()-Date.parse(dr)) / 1000) % 60);
                  hrs = (hrs < 10) ? "0" + hrs : hrs;
                  min = (min < 10) ? "0" + min : min;
                  sec = (sec < 10) ? "0" + sec : sec;
                  isFinite(dt) ? dt.toLocaleString(['ru-RU', 'en-US']) +
                  " (Up: " + hrs + ":" + min + ":" + sec + ")" : ""}
                  else "off"
            css:
              table+: "padding-top: 15px;"
              "tbody tr:nth-child(even)": "background-color: #a2542f6;"
              td.left: "padding: 10px 10px 10px 10px"
              th.left: "padding: 0px 0px 10px 10px"
          # ZigBee
          - type: markdown
            content: '<center> <ha-icon icon="mdi:zigbee"></ha-icon> ZigBee </center>'
          - type: "custom:flex-table-card"
            clickable: false
            entities:
              include:
                - sensor.*_zigbee
            sort_by: state- #ieee
            columns:
              - data: friendly_name
                name: Friendly Name
                modify: 'x.replace(/ Zigbee$/,"")'
              - data: gate
                name: Gate
                modify: x+''
              - data: ieee
                name: IEEE
                modify: (x+'').toLowerCase()
              - data: nwk
                name: NWK
                modify: (x+'').replace(/^0x/,"")
              - data: parent
                name: Parent
                modify: (x+'').replace(/^0x/,"").toLowerCase()
              - data: type
                name: Type
                modify: (x+'').replace(/^-$/, "child device")
              - data: msg_received
                name: Received
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: msg_missed
                name: Missed (Total)
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: last_missed
                name: Missed (Last)
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: unresponsive
                name: Unresponsive
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: reset_cnt
                name: Reset Count
                modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
              - data: linkquality
                name: LQI
                modify: 'isNaN(parseInt(x, 10)) ? "" : parseInt(x, 10)'
              - data: rssi
                name: RSSI
                modify: 'isNaN(parseInt(x, 10)) ? "" : parseInt(x, 10)'
              - data: last_msg
                name: Last Message
                modify: x+''
              - data: state
                name: Last Seen
                # modify: >
                #   var dt = new Date(0,0,0,0,0,0,(Date.now()-Date.parse(x)));
                #   isFinite(dt) ? dt.toTimeString().split(" ")[0] : ""
                modify: >
                  var min = Math.round((Date.now()-Date.parse(x))/60000);
                  isFinite(min) ? min : 65536
            css:
              table+: "padding-top: 15px;"
              "tbody tr:nth-child(even)": "background-color: #a2542f6;"
              td.left: "padding: 10px 10px 10px 10px"
              th.left: "padding: 0px 0px 10px 10px"

          # Bluetooth
          - type: markdown
            content: '<center> <ha-icon icon="mdi:bluetooth"></ha-icon> Bluetooth </center>'
          - type: "custom:flex-table-card"
            clickable: false
            entities:
              include:
                - sensor.*_ble
            sort_by: mac
            columns:
              - data: friendly_name
                name: Friendly Name
                modify: 'x.replace(/ Ble$/,"")'
              - data: mac
                name: MAC
                modify: (x+'').replace(/(.{2}(?!$))/g,"$1:")
              - data: msg_received
                name: Received
                modify: 'isNaN(parseInt(x, 10)) ? "" : parseInt(x, 10)'
              - data: state
                name: Last Seen
                modify: >
                  var dt = new Date(0,0,0,0,0,0,(Date.now()-Date.parse(x)));
                  isFinite(dt) ? dt.toTimeString().split(" ")[0] : ""
            css:
              table+: "padding-top: 15px;"
              "tbody tr:nth-child(even)": "background-color: #a2542f6;"
              td.left: "padding: 10px 10px 10px 10px"
              th.left: "padding: 0px 0px 10px 10px"

  - title: Карта
    path: map
    panel: true
    # badges:
    #   - person.kostik
    icon: mdi:map-legend
    cards:
        - type: map
          entities:
            - zone.home
            - zone.work
            - zone.home_kaluga
            - person.kostik
          hours_to_show: 48
          default_zoom: 15
