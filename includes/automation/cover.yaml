
#Открытие штор на кухне, по уличному датчику света
    - alias: open shades kitchen on outside light sensor
      id: open shades kitchen on outside light sensor
      mode: single
      max_exceeded: silent
      trigger:
      - platform: numeric_state
        entity_id: sensor.0x04cf8cdf3c7d15b7_illuminance_lux
        above: 250
        for:
          minutes: 10
      - platform: numeric_state
        id: 'sun'
        entity_id: sun.sun
        attribute: elevation
        above: 5
      condition:
        - condition: template
          value_template: >-
            {{ 
              trigger.id == 'sun' or
              trigger.from_state.state not in ['unknown', 'unavailable', 'none', ''] and 
              trigger.from_state.state != trigger.to_state.state
            }}
        - condition: numeric_state
          entity_id: sun.sun
          attribute: elevation
          above: 0
        - "{{ states.cover | selectattr('entity_id', 'in', state_attr('cover.cover_group_kitchen', 'entity_id')) | selectattr('state', 'eq', 'open') | map(attribute='entity_id') | list | length == 0 }}"
      action:
        - service: script.auto_cover_open_close
          data:
            servicename: 'cover.open_cover'
            groupname: 'cover.cover_group_kitchen'
            statename: 'closed'

#Закрытие штор на кухне, по уличному датчику света
    - alias: close shades kitchen on outside light sensor
      id: close shades kitchen on outside light sensor
      mode: restart
      trigger:
      - platform: numeric_state
        entity_id: sensor.0x04cf8cdf3c7d15b7_illuminance_lux
        below: 200
        for:
          minutes: 10
      - platform: numeric_state
        entity_id: sensor.0x04cf8cdf3c7d15b7_illuminance_lux
        below: 100
        for:
          minutes: 5
      condition:
        - condition: template
          value_template: >-
            {{ 
              trigger.from_state.state not in ['unknown', 'unavailable', 'none', ''] and 
              trigger.from_state.state != trigger.to_state.state
            }}
        - condition: numeric_state
          entity_id: sun.sun
          attribute: elevation
          below: 7
        - "{{ states.cover | selectattr('entity_id', 'in', state_attr('cover.cover_group_kitchen', 'entity_id')) | selectattr('state', 'eq', 'closed') | map(attribute='entity_id') | list | length == 0 }}"
      action:
        - service: script.auto_cover_open_close
          data:
            servicename: 'cover.close_cover'
            groupname: 'cover.cover_group_kitchen'
            statename: 'open'

    - alias: close shades kitchen on sun and min outside lux
      id: close shades kitchen on sun and min outside lux
      trigger:
      - platform: numeric_state
        entity_id: sun.sun
        attribute: elevation
        below: 2
      condition:
        - "{{ states('sensor.0x04cf8cdf3c7d15b7_illuminance_lux') | int(0) <= 200 }}"
        - "{{ states.cover | selectattr('entity_id', 'in', state_attr('cover.cover_group_kitchen', 'entity_id')) | selectattr('state', 'eq', 'closed') | map(attribute='entity_id') | list | length == 0 }}"
      action:
        - service: script.auto_cover_open_close
          data:
            servicename: 'cover.close_cover'
            groupname: 'cover.cover_group_kitchen'
            statename: 'open'
