
    # - alias: debug this for automations
    #   #id: debug this for automations
    #   initial_state: true
    #   trigger:
    #     - platform: time_pattern
    #       minutes: "/10"
    #   condition: >
    #     {{ 
    #         as_local(this.attributes.last_triggered) <= now() - timedelta(minutes=1, seconds = 30) 
    #     }}
    #   action:
    #     - service: telegram_bot.send_message
    #       data:
    #         target: !secret telegram_enzokot_chat_id
    #         parse_mode: 'html'
    #         title: >-
    #                  {{ '\U0001F41B' }} <b>Отладка</b>
    #         message: >-
    #                 last_triggered: {{ this.attributes.last_triggered }} -> now: {{ now() }}

    - alias: notification public ip compare debug
      id: notification public ip compare debug
      trigger:
          - platform: state
            entity_id: sensor.myip_keenetic
      condition: >
            {% set ignore = ['unknown', 'unavailable', 'none', None, null, ''] %}
            {{ trigger.from_state.state not in ignore and
               trigger.to_state.state not in ignore and
               trigger.from_state.state != trigger.to_state.state and
               trigger.to_state.state != states('sensor.myip')
            }}
      action:
        - service: telegram_bot.send_message
          data:
            target: !secret telegram_enzokot_chat_id
            title: >-
                     {{ '\U0001f4f6' }} *Трекинг устройств*
            message: >-
                    Внешний IP-адрес keendns `{{ trigger.to_state.state }}` не равен физическому `{{ states('sensor.myip') }}`

#Установка скорости мотора штор на текущую, для обновления атрибута last_seen
    - alias: auto_set_speed_shades_drive_motor
      trigger:
        - platform: time_pattern
          minutes: "/55"
      action:
        - choose:
            - conditions: "{{ state_attr('cover.0x847127fffed62861', 'motor_speed') | int(0) > 0 }}"
              sequence:      
                - service: script.set_speed_shades_drive_motor
                  data:
                    namemotor: 'Left shades drive motor kitchen'
                    speed: "{{ state_attr('cover.0x847127fffed62861', 'motor_speed') }}"
        - choose:
            - conditions: "{{ state_attr('cover.0x847127fffed4907d', 'motor_speed') | int(0) > 0 }}"
              sequence:      
                - service: script.set_speed_shades_drive_motor
                  data:
                    namemotor: 'Right shades drive motor kitchen'
                    speed: "{{ state_attr('cover.0x847127fffed4907d', 'motor_speed') }}"
