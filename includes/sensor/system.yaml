
  - platform: time_date
    display_options:
      - 'time'
      - 'date'
      - 'time_date'

  - platform: systemmonitor
    resources:
    - type: processor_use
    - type: processor_temperature
    - type: disk_use_percent
      arg: /
    - type: disk_use
      arg: /
    - type: disk_free
      arg: /
    - type: memory_use_percent
    - type: last_boot

#  - platform: filesize
#    file_paths:
#     - /config/home-assistant_v2.db

#Размер базы MariaDB
  - platform: sql
    db_url: !secret connection_string
    queries:
      - name: Maria DB size
        query: 'SELECT table_schema "database", round(Sum(data_length + index_length) / 1048576, 1) "value" FROM information_schema.tables WHERE table_schema="homeassistant" GROUP BY table_schema;'
        column: 'value'
        unit_of_measurement: MB

#На хосте "du -s /usr/share/hassio/addons/data/core_mariadb/databases/homeassistant/"
  - platform: mqtt
    name: Maria DB folder size
    state_topic: "folders_sizes/mariadb_homeassistant"
    icon: mdi:folder-eye
    unit_of_measurement: MB
    value_template: "{{ (value | float(0.0) / 1024) | round(1, 'common', 0) }}"

#Supervisor versions
  - platform: command_line
    name: Supervisor versions
    command: 'curl http://supervisor/supervisor/info -H "Authorization: Bearer $(printenv SUPERVISOR_TOKEN)" | jq ''{"newest_version":.data.version_latest,"current_version":.data.version,"update_available":.data.update_available,"healthy":.data.healthy,"addons":[.data.addons[] | select(.update_available)]}'''
    value_template: "{{ value_json.addons | length }}"
    unit_of_measurement: pending update(s)
    json_attributes:
    - update_available
    - newest_version
    - current_version
    - healthy
    #- addons

#Размер базы influxdb
  - platform: influxdb
    host: a0d7b954-influxdb
    port: 8086
    username: !secret influxdb_user
    password: !secret influxdb_password
    queries:
      - name: InfluxDB_DB_Size
        unit_of_measurement: MB
        value_template: '{{ (value | float(0.0) / 1024 / 1024) | round(1, "common", 0) }}'
        group_function: mean
        measurement: '"monitor"."tsm1_filestore"'
        database: _internal
        where: 'time > now() - 10s AND "database"=''homeassistant'''
        field: diskBytes 

#На хосте "du -s /usr/share/hassio/addons/data/a0d7b954_influxdb/influxdb/data/homeassistant/"
  - platform: mqtt
    name: InfluxDB DB folder size
    state_topic: "folders_sizes/influxdb_homeassistant"
    icon: mdi:folder-eye
    unit_of_measurement: MB
    value_template: "{{ (value | float(0.0) / 1024) | round(1, 'common', 0) }}"


#Сенсор длительности старта НА
#   - platform: command_line
#     name: "HA start time"
#     command: 'grep -m 1 -o "Home[[:space:]]Assistant[[:space:]]initialized[[:space:]]in[[:space:]][0-9]\+.[0-9]\+" /config/home-assistant.log | grep -o "[0-9]\+.[0-9]\+$" || echo -1'
#     scan_interval: 180
#     unit_of_measurement: "sec"

#Сенсор с датой любого link down на Keenetic
  - platform: mqtt
    name: check keenetic link down
    state_topic: "network_diagnostics/check_keenetic_link_down"
    icon: mdi:calendar-clock

#Сенсоры ошибок и предупрежений в логах НА
  - platform: command_line
    name: errors in system log command line
    command: grep -c -E "^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2} ERROR .*$" /config/home-assistant.log || true
    scan_interval: 600
    unit_of_measurement: pc
    
  - platform: command_line
    name: warnings in system log command line
    command: grep -c -E "^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2} WARNING .*$" /config/home-assistant.log || true
    scan_interval: 600
    unit_of_measurement: pc

#Сенсор external_url для чтения данных с конфига
  - platform: python_script
    name: instance external url config
    scan_interval: '00:05:00'
    source: |
        from homeassistant.helpers import network
        try:
            self.state = network.get_url(
                self.hass,
                allow_internal=False,
            )
        except network.NoURLAvailableError:
            raise MyInvalidValueError("Failed to find suitable URL for my integration")

#Сенсор internal_url для чтения данных с конфига
  - platform: python_script
    name: instance internal url config
    scan_interval: '00:05:00'
    source: |
        from homeassistant.helpers.network import get_url
        self.state = get_url(self.hass)

#Доступность Telegram API
  - platform: command_line
    name: telegram status
    command: "curl --silent --fail -m 5 -o /dev/null -G https://api.telegram.org/bot{{ states('input_text.var_telegram_bot_api_token') }}/getMe && echo online || echo offline"

#Количество подключенных клиентов к API HA
  - platform: websocket_api
